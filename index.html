<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Function Graph 3D</title>
  <style>
    html, body { margin: 0; height: 100%; overflow: hidden; background: #0b0f14; }

    .hudbox {
      position: fixed;
      top: 78px;
      color: #cfd8dc;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      font-size: 13px;
      line-height: 1.3;
      background: rgba(20, 24, 31, 0.75);
      padding: 8px 10px;
      border-radius: 8px;
      white-space: pre;
      pointer-events: none;
      z-index: 2;
      max-width: 30vw;
    }

    #hud_left { left: 12px; }
    #hud_center { left: 50%; transform: translateX(-50%); text-align: center; }
    #hud_right { right: 12px; text-align: right; }

    #minimap {
      position: fixed;
      right: 12px;
      bottom: 12px;
      width: 180px;
      height: 180px;
      background: rgba(10, 12, 16, 0.62);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 12px;
      z-index: 2;
      pointer-events: none;
      overflow: hidden;
    }

    #minimap canvas {
      display: block;
      width: 180px;
      height: 180px;
    }

    #hud_vars_wrap {
      position: fixed;
      left: 12px;
      top: 154px;
      display: flex;
      flex-direction: row;
      gap: 10px;
      z-index: 2;
      pointer-events: auto;
      align-items: flex-start;
    }

    #hud_vars_minimap {
      width: 26px;
      height: calc(100vh - 160px);
      border-radius: 8px;
      background: rgba(20, 24, 31, 0.35);
      border: 1px solid rgba(255,255,255,0.10);
      overflow: hidden;
      pointer-events: none;
      display: none;
    }

    #hud_vars_minimap canvas {
      display: block;
      width: 26px;
      height: 100%;
    }

    #hud_vars {
      position: static;
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 360px;
      max-width: 360px;
      max-height: calc(100vh - 160px);
      overflow: auto;
      pointer-events: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    #hud_vars::-webkit-scrollbar {
      width: 0;
      height: 0;
    }

    .varbox {
      color: #cfd8dc;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      font-size: 12px;
      line-height: 1.25;
      background: rgba(20, 24, 31, 0.75);
      padding: 8px 10px;
      border-radius: 8px;
      white-space: normal;
      width: 340px;
      max-width: 340px;
      display: flex;
      flex-direction: column;
      gap: 2px;
      border: 1px solid rgba(255,255,255,0.10);
      opacity: 0.92;
    }

    .varbox.dim {
      opacity: 0.30;
    }

    .varbox.active {
      opacity: 0.92;
      border-color: rgba(255,255,255,0.24);
    }

    .varname {
      color: #ffffff;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .varmeta {
      color: #cfd8dc;
      opacity: 0.85;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .varhead {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      min-width: 0;
    }

    .varbadge {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.22);
      background: rgba(255,255,255,0.10);
      color: #ffffff;
      font-size: 11px;
      line-height: 18px;
      text-align: center;
      flex: 0 0 auto;
      user-select: none;
    }

    .varbox.dim .varbadge {
      opacity: 0.45;
    }

    .varbox.active .varbadge {
      border-color: rgba(255,255,255,0.40);
      background: rgba(255,255,255,0.16);
      opacity: 1;
    }

    #topbar {
      position: fixed;
      left: 0;
      right: 0;
      top: 0;
      height: 52px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 12px;
      background: rgba(10, 12, 16, 0.85);
      backdrop-filter: blur(6px);
      z-index: 3;
    }

    #tabs {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .tabbtn {
      pointer-events: auto;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(20, 24, 31, 0.75);
      color: #cfd8dc;
      padding: 7px 10px;
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      user-select: none;
    }

    .tabbtn.active {
      border-color: rgba(255,255,255,0.30);
      background: rgba(40, 46, 58, 0.85);
      color: #ffffff;
    }

    #runtime_controls {
      display: none;
      align-items: center;
      gap: 8px;
      margin-left: 10px;
    }

    .ctlbtn {
      pointer-events: auto;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(20, 24, 31, 0.75);
      color: #cfd8dc;
      padding: 7px 10px;
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      user-select: none;
      min-width: 34px;
      text-align: center;
    }

    .ctlbtn:active {
      transform: translateY(1px);
    }

    #rt_step {
      color: #cfd8dc;
      font-size: 12px;
      opacity: 0.85;
      padding: 0 6px;
      white-space: nowrap;
    }

    #rt_speed {
      pointer-events: auto;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(20, 24, 31, 0.75);
      color: #cfd8dc;
      padding: 7px 10px;
      border-radius: 8px;
      outline: none;
      font-size: 13px;
    }
    #rt_main_label {
      margin-left: auto;
      color: #cfd8dc;
      font-size: 12px;
      opacity: 0.9;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 44vw;
      pointer-events: none;
      display: none;
    }

    #rt_steps {
      margin-top: 10px;
      border-top: 1px solid rgba(255,255,255,0.10);
      padding-top: 10px;
    }

    .rtrow {
      display: grid;
      grid-template-columns: 70px 1fr;
      gap: 10px;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      cursor: pointer;
    }

    .rtrow:hover { background: rgba(255,255,255,0.04); }

    .rtrow .ln { opacity: 0.8; font-variant-numeric: tabular-nums; }
    .rtrow .txt { color: #ffffff; }
    .rtrow.active { background: rgba(255,255,255,0.06); }

    #search {
      pointer-events: auto;
      width: 320px;
      max-width: 44vw;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(20, 24, 31, 0.75);
      color: #cfd8dc;
      padding: 8px 10px;
      border-radius: 8px;
      outline: none;
      font-size: 13px;
    }

    #listpanel {
      position: fixed;
      left: 12px;
      right: 12px;
      top: 64px;
      bottom: 12px;
      background: rgba(10, 12, 16, 0.82);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 12px;
      overflow: hidden;
      display: none;
      z-index: 3;
      pointer-events: auto;
    }

    #runtimepanel {
      position: fixed;
      left: 12px;
      right: 12px;
      top: 64px;
      bottom: 12px;
      background: rgba(10, 12, 16, 0.82);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 12px;
      overflow: hidden;
      display: none;
      z-index: 3;
      pointer-events: auto;
    }

    .panelhead {
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      display: flex;
      gap: 10px;
      align-items: baseline;
      color: #cfd8dc;
      font-size: 13px;
    }

    .panelhead .meta {
      opacity: 0.8;
      font-size: 12px;
    }

    .panelbody {
      height: calc(100% - 44px);
      overflow: auto;
      padding: 12px;
      color: #cfd8dc;
      font-size: 13px;
    }

    #list {
      height: calc(100% - 44px);
      overflow: auto;
      padding: 6px 0;
      background: transparent;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 110px 110px 120px;
      gap: 10px;
      padding: 8px 12px;
      color: #cfd8dc;
      font-size: 13px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      cursor: pointer;
    }

    .row:hover {
      background: rgba(255,255,255,0.04);
    }

    .row .name { color: #ffffff; }
    .row .muted { opacity: 0.85; text-align: right; }

    #fn_modal_backdrop {
      position: fixed;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.55);
      z-index: 5;
      display: none;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
    }

    #fn_modal {
      width: 720px;
      max-width: calc(100vw - 36px);
      max-height: calc(100vh - 96px);
      background: rgba(10, 12, 16, 0.92);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 12px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 18px 60px rgba(0,0,0,0.55);
    }

    #fn_modal_header {
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      color: #cfd8dc;
    }

    #fn_modal_title {
      color: #ffffff;
      font-size: 13px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    #fn_modal_body {
      padding: 12px;
      color: #cfd8dc;
      font-size: 13px;
      overflow: auto;
      line-height: 1.35;
    }

    #fn_modal_footer {
      padding: 10px 12px;
      border-top: 1px solid rgba(255,255,255,0.10);
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: flex-end;
      flex-wrap: wrap;
    }

    #fn_modal_body .kv {
      display: grid;
      grid-template-columns: 120px 1fr;
      gap: 8px;
      padding: 6px 0;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    #fn_modal_body .k {
      opacity: 0.80;
      font-variant-numeric: tabular-nums;
    }

    #fn_modal_body .v {
      color: #ffffff;
      overflow-wrap: anywhere;
    }

    #fn_modal_body .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      color: #cfd8dc;
      opacity: 0.92;
      white-space: pre-wrap;
    }

    #fn_modal_body .varlink {
      cursor: pointer;
      color: #ffffff;
      text-decoration: underline;
      text-decoration-color: rgba(255,255,255,0.22);
      text-underline-offset: 2px;
    }

    #fn_modal_body .varlink:hover {
      text-decoration-color: rgba(255,255,255,0.55);
    }

    #var_modal_backdrop {
      position: fixed;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.55);
      z-index: 6;
      display: none;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
    }

    #var_modal {
      width: 560px;
      max-width: calc(100vw - 36px);
      max-height: calc(100vh - 96px);
      background: rgba(10, 12, 16, 0.92);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 12px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 18px 60px rgba(0,0,0,0.55);
    }

    #var_modal_header {
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      color: #cfd8dc;
    }

    #var_modal_title {
      color: #ffffff;
      font-size: 13px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    #var_modal_body {
      padding: 12px;
      color: #cfd8dc;
      font-size: 13px;
      overflow: auto;
      line-height: 1.35;
    }

    #var_modal_body .kv {
      display: grid;
      grid-template-columns: 120px 1fr;
      gap: 8px;
      padding: 6px 0;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    #var_modal_body .k {
      opacity: 0.80;
      font-variant-numeric: tabular-nums;
    }

    #var_modal_body .v {
      color: #ffffff;
      overflow-wrap: anywhere;
    }

    #var_modal_body .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      color: #cfd8dc;
      opacity: 0.92;
      white-space: pre-wrap;
    }
  </style>
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
    }
  }
  </script>
</head>
<body>
<div id="hud_left" class="hudbox">Loading...</div>
<div id="hud_vars_wrap">
  <div id="hud_vars"></div>
  <div id="hud_vars_minimap">
    <canvas id="hud_vars_minimap_canvas" width="26" height="520"></canvas>
  </div>
</div>
<div id="hud_center" class="hudbox"> </div>
<div id="hud_right" class="hudbox"> </div>

<div id="minimap"><canvas id="minimap_canvas" width="180" height="180"></canvas></div>

<div id="topbar">
  <div id="tabs">
    <div id="domain_functions" class="tabbtn active">Functions</div>
    <div id="domain_runtime" class="tabbtn">Runtime</div>
    <div style="width:12px"></div>
    <div id="view_3d" class="tabbtn active">3D View</div>
    <div id="view_list" class="tabbtn">List</div>
  </div>
  <input id="search" type="text" placeholder="Search functions..." style="display:none" />
  <div id="runtime_controls">
    <div id="rt_prev" class="ctlbtn">◀</div>
    <div id="rt_play" class="ctlbtn">Play</div>
    <div id="rt_next" class="ctlbtn">▶</div>
    <div id="rt_step">0 / 0</div>
    <select id="rt_speed">
      <option value="0.4">0.4x</option>
      <option value="0.7">0.7x</option>
      <option value="1" selected>1x</option>
      <option value="1.5">1.5x</option>
      <option value="2">2x</option>
      <option value="5">5x</option>
    </select>
    <label id="rt_show_inactive_wrap" style="display:flex; align-items:center; gap:6px; font-size:12px; opacity:0.9; user-select:none;">
      <input id="rt_show_inactive" type="checkbox" checked />
      Show inactive vars
    </label>
  </div>
  <div id="rt_main_label"></div>
</div>

<div id="listpanel">
  <div class="panelhead">
    <div>Functions</div>
    <div class="meta" id="listmeta"></div>
  </div>
  <div id="list"></div>
</div>
<div id="runtimepanel" style="display:none">
  <div class="panelhead">
    <div>Runtime</div>
    <div class="meta">(live / sampled execution data)</div>
  </div>
  <div class="panelbody">
    Runtime logic playback (derived from callsite line order).

    <div id="rt_info"></div>
    <div id="rt_steps"></div>
  </div>
</div>

<div id="fn_modal_backdrop" style="display:none">
  <div id="fn_modal" role="dialog" aria-modal="true" aria-labelledby="fn_modal_title">
    <div id="fn_modal_header">
      <div id="fn_modal_title">Function</div>
      <div id="fn_modal_close" class="ctlbtn" style="min-width:auto; padding:6px 10px">Close</div>
    </div>
    <div id="fn_modal_body"></div>
    <div id="fn_modal_footer">
      <div id="fn_modal_btn_show3d" class="ctlbtn">Show in 3D</div>
      <div id="fn_modal_btn_setmain" class="ctlbtn">Set as Main</div>
      <div id="fn_modal_btn_resetrt" class="ctlbtn">Reset runtime data</div>
    </div>
  </div>
</div>
<div id="var_modal_backdrop" style="display:none">
  <div id="var_modal" role="dialog" aria-modal="true" aria-labelledby="var_modal_title">
    <div id="var_modal_header">
      <div id="var_modal_title">Variable</div>
      <div id="var_modal_close" class="ctlbtn" style="min-width:auto; padding:6px 10px">Close</div>
    </div>
    <div id="var_modal_body"></div>
  </div>
</div>


<script type="module">
  import { bootFunctionsGraph3D } from "./fg3d.js";
  bootFunctionsGraph3D({ });
</script>
</body>
</html>


